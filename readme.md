# Модуль 27. Авторизация и аутентификация

LICENSE: [MIT](./license.md)


Здравствуйте, в данной работе надо было сделать авторизация и аутентификация.Так как я уже делал авторизацию в 25 модуле, решил взять от туда уже готовое решение, единственное, прописал в БД столбец для групп и при регистрации по умалчаю дается группа 'user'.

Среди условий было использование API VK и CSRF-токена , я использовал API Яндекса , так как в Vk не смог зарегестрировать свое приложения , без ssl сертефиката (http протокол). А покупать сертификат или арендовать сервер не особо хотелось. Да и принцип работы одинаковый так , что я думаю это не принципиальный вопрос. 

-------------------------------------------
В краце опишу работу API:
Для начало необходимо зарегистрировать приложение на той платформе с которой необходимо работать , в моем случаии это яндекс. После регистрации я получаю client_id и secret_id код. На странице login.page.php , я сверстал кнопку яндекса, прекрипил к ней ссылку моего приложения и дополнительный GET параметры как : client_id = 'id моего приложение',  redirect_uri= 'редирект на php страницу которая будет обрабатывать ответ от яндекса', response_type = 'что мне нужно от яндекса' , остальные параметры может вбивать пользователь.

Полсе удачной регистрации логика идет в моем случаи 'http://localhost:8000/ya_login'. То есть в контроллер  YandexController.php, который работает с YandexModel.php. В методе ya_login, если существует ответ от страници с автаризацией , то я прилогая свой client_id, client_secret и код который получил от яндекса. Отправляю данные по ссылке из документации , далее получаю json массив который декодирую и получаю от туда email, аватарку, username, группа по умолчаю дается 'yandex', пароль генерируется из метода generatePassword. Далее идет проверка если такой пользователь существует в БД записать его в сессию , если его нет создать и записать в сессию       
_______________________________________________________

Одним из заданий было , что бы полтзователи заходили на одну и туже страницу и видели разный контент:

Поэтому переходя по ссылке /ex_content, перехожу в ContentController и работую с моделью ContentModel. Там проверяю какая группа у пользователя. Далее его перекидывает в content.page.php , где в зависемости от группы , выберается какие компоненты подгрузятся для неаторизованного пользователя, для обычного , или для яндекс юзера.

________________________________________________________

Для системы логов , после прочтение теории , я так понял нужно записывать результаты в файл. Поэтому после не удачной регистрации подключаю модель LogeModel , где вписываю в масив e-mail, group, error, и время . Массив записывается в auth_log в папке log. 

Пункты все выполнил и работу считаю законченной.


---

GiT logo by GitHub.Own work using: https://github.com/logos, 
license: [CC BY 3.0](https://creativecommons.org/licenses/by/3.0/deed.ru)